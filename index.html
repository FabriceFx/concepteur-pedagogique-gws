<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Concepteur Pédagogique Google Workspace</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"/>
    
    <link rel="stylesheet" href="styles.css">
    <script src="app.js" defer></script>
</head>
<body class="p-2 md:p-4 hide-types text-slate-900">
    <div class="max-w-7xl mx-auto">
        <header class="mb-3">
            <h1 class="text-2xl font-bold text-slate-900 leading-tight">
                Concepteur Pédagogique - Google Workspace
            </h1>
            <div class="mt-2 flex flex-wrap gap-x-3 gap-y-3 no-print items-start content-start">
                <div class="flex flex-col relative gap-0.5 bg-slate-50 border border-slate-200 rounded-lg p-1">
                    <span class="text-[9px] font-bold text-slate-500 uppercase tracking-wider pl-1" data-i18n="grp_project">Projet</span>
                    <div class="flex items-center bg-white border border-slate-200 rounded-md p-0.5 gap-0.5 shadow-sm h-[34px]">
                        <button class="text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded transition-colors flex items-center gap-1.5" data-i18n-title="title_save_project" onclick="App.Data.saveProject()">
                            <span class="material-icons-round text-lg">save</span>
                            <span class="text-xs font-medium hidden md:inline" data-i18n="btn_save">Enregistrer</span>
                        </button>
                        <button class="text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded transition-colors flex items-center gap-1.5" data-i18n-title="title_load_project" onclick="triggerFileLoad()">
                            <span class="material-icons-round text-lg">file_upload</span>
                            <span class="text-xs font-medium hidden md:inline" data-i18n="btn_load">Charger</span>
                        </button>
                        <div class="w-px bg-slate-200 my-1 mx-0.5"></div>
                        <div class="relative group">
                            <div class="flex items-center">
                                <span class="material-icons-round text-slate-600 absolute left-1.5 pointer-events-none text-lg z-10 group-hover:text-indigo-600 transition-colors">download</span>
                                <select class="appearance-none bg-transparent hover:bg-indigo-50 text-slate-600 hover:text-indigo-600 pl-7 pr-6 py-1 rounded transition-colors outline-none cursor-pointer text-xs font-medium h-[28px]" data-i18n-title="title_export_dropdown" onchange="App.Export.handleExport(this)">
                                    <option data-i18n="btn_export_dropdown" disabled="" selected="" value="">Exporter...</option>
                                    <option data-i18n="opt_md" value="markdown">Markdown</option>
                                    <option data-i18n="opt_csv" value="csv">CSV</option>
                                    <option value="txt">Texte (.txt)</option>
                                    <option value="docx">Word (.docx)</option>
                                    <option data-i18n="opt_pdf" value="pdf">PDF</option>
                                    <option data-i18n="opt_rtf" value="richtext">Texte enrichi</option>
                                    <option data-i18n="opt_real_rtf" value="rtf">Text (.rtf)</option>
                                </select>
                                <span class="material-icons-round text-slate-400 pointer-events-none absolute right-1 text-sm">expand_more</span>
                            </div>
                        </div>
                        <input accept=".json" class="hidden" id="load-file-input" onchange="loadProject(event)" type="file"/>
                    </div>
                </div>

                <div class="flex flex-col relative gap-0.5 shrink-0 bg-slate-50 border border-slate-200 rounded-lg p-1">
                    <span class="text-[9px] font-bold text-slate-500 uppercase tracking-wider pl-1">Modèles</span>
                    <div class="flex items-center bg-white border border-slate-200 rounded-md p-0.5 gap-1 shadow-sm h-[34px] min-w-max">
                        <button class="text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded transition-colors flex items-center gap-1.5" id="btn-template-export" onclick="openTemplateExportModal()" title="Exporter un modèle" type="button">
                            <span class="material-icons-round text-lg">upload_file</span>
                            <span class="text-xs font-medium hidden md:inline">Exporter</span>
                        </button>
                        <button class="text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded transition-colors flex items-center gap-1.5" id="btn-template-import" onclick="openTemplateImportModal()" title="Importer un modèle" type="button">
                            <span class="material-icons-round text-lg">download_for_offline</span>
                            <span class="text-xs font-medium hidden md:inline">Importer</span>
                        </button>
                        <input accept=".json" class="hidden" id="template-file-input" type="file"/>
                    </div>
                </div>

                <div class="flex flex-col relative gap-0.5 bg-slate-50 border border-slate-200 rounded-lg p-1">
                    <span class="text-[9px] font-bold text-slate-500 uppercase tracking-wider pl-1" data-i18n="grp_view">Vue</span>
                    <div class="flex items-center bg-white border border-slate-200 rounded-md p-0.5 gap-1 shadow-sm h-[34px]">
                        <button class="text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded transition-colors flex items-center justify-center ml-0.5" data-i18n-title="title_fold_all" id="btn-toggle-all-header" onclick="toggleAllActivities()">
                            <span class="material-icons-round text-xl" id="icon-toggle-all">unfold_less</span>
                        </button>
                        <div class="w-px h-5 bg-slate-200"></div>
                        <button aria-pressed="false" class="text-slate-700 hover:text-indigo-700 hover:bg-slate-50 active:bg-slate-100 px-2 h-[28px] rounded-md transition flex items-center gap-1" id="contrast-toggle-btn" onclick="App.UI.toggleHighContrast(event)" title="Passer au haut contraste" type="button">
                            <span class="material-icons-round text-base">invert_colors</span>
                            <span class="text-[11px] font-extrabold tracking-wide" id="contrast-btn-text">STD</span>
                        </button>
                        <div class="w-px h-5 bg-slate-200"></div>
                        <button class="text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded transition-colors flex items-center gap-1" data-i18n-title="title_toggle_types" onclick="toggleLearningTypes()">
                            <span class="material-icons-round text-base" id="icon-toggle-types">visibility_off</span>
                            <span class="text-xs font-bold" data-i18n="btn_toggle_types">Types d'appr.</span>
                        </button>
                        <div class="w-px h-5 bg-slate-200"></div>
                    </div>
                </div>
            </div>
        </header>

        <div class="mb-3 bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden">
            <button class="w-full px-3 py-2 flex items-center justify-between bg-slate-50 hover:bg-slate-100 transition-colors no-print h-[32px] rounded-lg border border-slate-200" data-i18n-title="title_toggle_panel" onclick="togglePanel('key-params-panel')">
                <div class="flex items-center gap-1.5">
                    <span class="material-icons-round text-slate-500 text-sm">tune</span>
                    <span class="font-bold text-slate-700 uppercase text-xs tracking-wide" data-i18n="panel_key_parameters">Informations sur la formation</span>
                </div>
                <span class="material-icons-round text-slate-400 rotate-icon text-sm" id="key-params-panel-icon">expand_more</span>
            </button>
            <div class="panel-content" id="key-params-panel" style="display: none;">
                <div class="p-3 border-t border-slate-100 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                    <div>
                        <label class="compact-label block" data-i18n="label_course_name">Nom de la formation</label>
                        <input class="w-full px-2 py-1 border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none" data-i18n-placeholder="ph_course_name" id="param-name" placeholder="Formation Google Workspace : [Outil/Niveau]" type="text"/>
                    </div>
                    <div class="flex-1">
                        <label class="compact-label block" data-i18n="label_learning_time">Temps d'Apprentissage (Cible)</label>
                        <div class="flex gap-1">
                            <input class="w-2/3 px-2 py-1 border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none" id="param-learning-val" min="0" oninput="App.Timeline.updateStatsDebounced()" placeholder="0" type="number"/>
                            <select class="w-1/3 px-1 py-1 text-xs border border-slate-200 rounded bg-slate-50 focus:ring-1 focus:ring-indigo-500 outline-none" id="param-learning-unit" onchange="App.Timeline.updateStats()">
                                <option data-i18n="unit_mins" value="mins">min</option>
                                <option data-i18n="unit_hours" value="hours">Heures</option>
                                <option data-i18n="unit_days" value="days">Jours</option>
                                <option data-i18n="unit_weeks" value="weeks">Semaines</option>
                                <option data-i18n="unit_months" value="months">Mois</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex-1">
                        <label class="compact-label block" data-i18n="label_designed_time">Temps Conçu (Planifié)</label>
                        <div class="flex gap-1 items-center">
                            <input class="w-2/3 px-2 py-1 border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none bg-slate-100 text-slate-500" id="param-designed-val" min="0" placeholder="0" readonly="" type="number"/>
                            <span class="w-1/3 text-xs text-slate-600 font-bold px-1" id="param-designed-unit-display">min</span>
                        </div>
                    </div>
                </div>
                <div class="p-3 border-t border-slate-100 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                    <div>
                        <label class="compact-label block" data-i18n="label_mode">Modalité</label>
                        <select class="w-full px-2 py-1 border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none bg-white" id="param-mode">
                            <option data-i18n="opt_mode_placeholder" disabled="" value="">Sélectionnez une modalité...</option>
                            <option data-i18n="opt_mode_blended" selected="" value="blended">Hybride (sur site et en ligne)</option>
                            <option data-i18n="opt_mode_classroom" value="classroom">Présentiel (sur site)</option>
                            <option data-i18n="opt_mode_online" value="online">Distanciel (en ligne)</option>
                        </select>
                    </div>
                    <div>
                        <label class="compact-label block" data-i18n="label_level">Niveau</label>
                        <select class="w-full px-2 py-1 border border-slate-200 rounded text-sm focus:ring-1 focus:ring-indigo-500 outline-none bg-white" id="param-level">
                            <option data-i18n="opt_level_unspecified" selected="" value="unspecified">Non spécifié</option>
                            <option data-i18n="opt_level_mixed" value="mixed">Mixte</option>
                            <option data-i18n="opt_level_beginner" value="beginner">Débutant</option>
                            <option data-i18n="opt_level_intermediate" value="intermediate">Intermédiaire</option>
                            <option data-i18n="opt_level_advanced" value="advanced">Avancé</option>
                            <option data-i18n="opt_level_expert" value="expert">Expert</option>
                        </select>
                    </div>
                    <div>
                        <label class="compact-label block" data-i18n="label_class_size">Taille de la cohorte</label>
                        <input class="w-full px-2 py-1 border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none font-bold text-slate-800" id="global-class-size" min="1" oninput="App.Timeline.updateStatsDebounced()" type="number" value="30"/>
                    </div>
                    <div>
                        <label class="compact-label block" data-i18n="label_authors">Auteur(s)</label>
                        <input class="w-full px-2 py-1 border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none" data-i18n-placeholder="ph_authors" id="param-authors" placeholder="Entrez le nom de l'auteur..." type="text"/>
                    </div>
                    <div class="md:col-span-2 lg:col-span-3">
                        <label class="compact-label block" data-i18n="label_description">Description générale</label>
                        <textarea class="w-full px-2 py-1 border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none resize-y" data-i18n-placeholder="ph_description" id="param-description" placeholder="Description détaillée..." rows="1"></textarea>
                    </div>
                    <div class="md:col-span-2 lg:col-span-3">
                        <label class="compact-label block" data-i18n="label_target_audience">Public cible</label>
                        <textarea class="w-full px-2 py-1 border border-slate-200 rounded text-sm focus:ring-1 focus:ring-indigo-500 outline-none resize-y" id="param-target-audience" placeholder="Collaborateurs migrant depuis Office 365 ou Nouveaux arrivants..." rows="1"></textarea>
                    </div>
                    <div class="md:col-span-2 lg:col-span-3">
                        <label class="compact-label block" data-i18n="label_prerequisites">Prérequis</label>
                        <textarea class="w-full px-2 py-1 border border-slate-200 rounded text-sm focus:ring-1 focus:ring-indigo-500 outline-none resize-y" id="param-prerequisites" placeholder="" rows="1"></textarea>
                    </div>
                    <div class="md:col-span-2 lg:col-span-3">
                        <label class="compact-label block" data-i18n="label_aims">Objectifs</label>
                        <textarea class="w-full px-2 py-1 border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none resize-y" data-i18n-placeholder="ph_aims" id="param-aims" placeholder="Entrez les objectifs..." rows="2"></textarea>
                    </div>
                    <div class="md:col-span-2 lg:col-span-3">
                        <label class="compact-label block" data-i18n="label_outcomes_text">Résultats d'apprentissage</label>
                        <textarea class="w-full px-2 py-1 border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none resize-y" data-i18n-placeholder="ph_outcomes_text" id="param-outcomes-text" placeholder="Entrez les résultats d'apprentissage..." rows="2"></textarea>
                    </div>
                    <div class="md:col-span-2 lg:col-span-3">
                        <label class="compact-label block" data-i18n="label_outcomes">Résultats d'apprentissage (Bloom)</label>
                        <div class="flex gap-1 mb-1 no-print flex-col sm:flex-row">
                            <div class="flex gap-1">
                                <select class="text-[10px] font-bold text-slate-600 border border-slate-200 rounded py-1 px-1 bg-white focus:ring-1 focus:ring-indigo-500 outline-none w-24" id="new-bloom-level">
                                    <option data-i18n="bloom_placeholder" disabled="" selected="" value="">Bloom...</option>
                                </select>
                                <select class="text-[10px] text-slate-600 border border-slate-200 rounded py-1 px-1 bg-white focus:ring-1 focus:ring-indigo-500 outline-none w-24 hidden" id="new-bloom-sub">
                                    <option data-i18n="bloom_sub_placeholder" disabled="" selected="" value="">Sous-cat...</option>
                                </select>
                            </div>
                            <div class="flex flex-1 gap-1">
                                <input class="flex-1 px-2 py-1 border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none text-xs" data-i18n-placeholder="ph_add_outcome" id="new-outcome-input" placeholder="Ajouter un résultat..." type="text"/>
                                <button class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded font-bold hover:bg-indigo-200 transition-colors flex items-center justify-center h-[26px]" data-action="add-outcome" data-i18n-title="title_add_outcome" id="btn-add-outcome" style="position:relative; z-index:5;" type="button">
                                    <span class="material-icons-round text-sm">add</span>
                                </button>
                            </div>
                        </div>
                        <ul class="space-y-0.5" id="outcomes-list"></ul>
                        <p class="text-xs text-slate-400 italic mt-1" data-i18n="text_no_outcomes" id="no-outcomes-text">Aucun résultat défini</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-3 no-print flex flex-col gap-3">
            <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden flex-1 flex flex-col justify-center" id="timelines-wrapper">
                <button class="w-full px-3 py-2 flex items-center justify-between bg-slate-50 hover:bg-slate-100 transition-colors no-print h-[32px] rounded-lg border border-slate-200" data-i18n-title="title_toggle_panel" onclick="togglePanel('timeline-panel')">
                    <div class="flex items-center gap-1.5">
                        <span class="material-icons-round text-slate-500 text-sm">insights</span>
                        <span class="font-bold text-slate-700 uppercase text-xs tracking-wide" data-i18n="panel_timelines_title">Visualisations des séquences</span>
                    </div>
                    <span class="material-icons-round text-slate-400 rotate-icon text-sm" id="timeline-panel-icon">expand_more</span>
                </button>
                <div class="panel-content w-full flex flex-col gap-2 mt-2 p-2 rounded-xl border border-slate-200 bg-slate-50" id="timeline-panel" style="display: none;">
                    <div class="flex justify-end">
                        <span class="text-slate-400 text-[10px] italic" data-i18n="status_calculating" id="stats-update-info"></span>
                    </div>
                    <div class="bg-white rounded-xl border border-slate-200 p-1.5 flex items-center justify-start gap-3 flex-wrap">
                        <div class="flex items-center gap-1.5">
                            <span aria-hidden="true" class="material-icons-round text-slate-500 text-base">zoom_in</span>
                            <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">Échelle temporelle</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <button class="px-2 py-1 rounded-lg border border-slate-200 bg-slate-50 hover:bg-slate-100 transition-colors flex items-center justify-center" id="timeline-zoom-out" title="Zoom arrière" type="button">
                                <span class="material-icons-round text-slate-600 text-base">remove</span>
                            </button>
                            <input class="w-40 md:w-56" id="timeline-zoom-range" max="3" min="0.5" step="0.1" type="range" value="1"/>
                            <span class="text-xs font-bold text-slate-600 w-12 text-right tabular-nums" id="timeline-zoom-value">100%</span>
                            <button class="px-2 py-1 rounded-lg border border-slate-200 bg-slate-50 hover:bg-slate-100 transition-colors flex items-center justify-center" id="timeline-zoom-in" title="Zoom avant" type="button">
                                <span class="material-icons-round text-slate-600 text-base">add</span>
                            </button>
                            <button class="px-2 py-1 rounded-lg border border-slate-200 bg-white hover:bg-slate-50 transition-colors flex items-center justify-center" id="timeline-zoom-reset" title="Réinitialiser" type="button">
                                <span class="material-icons-round text-slate-600 text-base">restart_alt</span>
                            </button>
                        </div>
                    </div>
                    <div class="timeline-track bg-white rounded-xl border border-slate-200 p-1.5 flex flex-col gap-1">
                        <div class="flex items-center justify-between gap-2 flex-wrap">
                            <div class="flex items-center gap-1.5">
                                <span aria-hidden="true" class="material-icons-round text-slate-500 text-base">view_agenda</span>
                                <span class="text-xs font-bold text-slate-500 uppercase tracking-wider" data-i18n="label_timeline_structure_planned">Modules prévus</span>
                            </div>
                        </div>
                        <div class="w-full h-6 flex rounded-lg overflow-hidden bg-slate-100 border border-slate-200 cursor-help timeline-zoom-outer" id="timeline-activities-planned">
                            <div class="timeline-inner" id="timeline-activities-planned-inner"></div>
                        </div>
                        <div class="w-full flex text-xs text-slate-600 font-medium leading-none mt-1 timeline-zoom-outer" id="timeline-activities-planned-labels">
                            <div class="timeline-inner" id="timeline-activities-planned-labels-inner"></div>
                        </div>
                    </div>
                    <div class="timeline-track bg-white rounded-xl border border-slate-200 p-1.5 flex flex-col gap-1">
                        <div class="flex items-center justify-between gap-2 flex-wrap">
                            <div class="flex items-center gap-1.5">
                                <span aria-hidden="true" class="material-icons-round text-slate-500 text-base">account_tree</span>
                                <span class="text-xs font-bold text-slate-500 uppercase tracking-wider" data-i18n="label_timeline_structure">Modules conçus</span>
                            </div>
                        </div>
                        <div class="w-full h-6 flex rounded-lg overflow-hidden bg-slate-100 border border-slate-200 cursor-help timeline-zoom-outer" id="timeline-activities">
                            <div class="timeline-inner" id="timeline-activities-inner"></div>
                        </div>
                        <div class="w-full flex text-xs text-slate-600 font-medium leading-none mt-1 timeline-zoom-outer" id="timeline-activities-labels">
                            <div class="timeline-inner" id="timeline-activities-labels-inner"></div>
                        </div>
                    </div>
                    <div class="timeline-track bg-white rounded-xl border border-slate-200 p-1.5 flex flex-col gap-1 timeline-track-pedagogy">
                        <div class="flex items-center justify-between gap-2 flex-wrap">
                            <div class="flex items-center gap-1.5">
                                <span aria-hidden="true" class="material-icons-round text-slate-500 text-base">psychology</span>
                                <span class="text-xs font-bold text-slate-500 uppercase tracking-wider" data-i18n="label_timeline_pedagogy">Types d'apprentissage</span>
                            </div>
                        </div>
                        <div class="w-full h-6 flex rounded-lg overflow-hidden bg-slate-100 border border-slate-200 cursor-help timeline-zoom-outer" id="timeline-steps">
                            <div class="timeline-inner" id="timeline-steps-inner"></div>
                        </div>
                    </div>
                    <button class="w-full px-2 py-1.5 flex items-center justify-between bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-colors" onclick="toggleTimelineDetails()" type="button">
                        <div class="flex items-center gap-1.5">
                            <span aria-hidden="true" class="material-icons-round text-slate-500 text-base">tune</span>
                            <span class="text-xs font-bold text-slate-500 uppercase tracking-wider" data-i18n="label_timeline_details">Détails</span>
                        </div>
                        <span class="material-icons-round text-slate-400 rotate-icon text-sm" id="timeline-details-icon">expand_more</span>
                    </button>
                    <div class="panel-content w-full flex flex-col gap-2" data-display="flex" id="timeline-details" style="display: none;">
                        <div class="timeline-track bg-white rounded-xl border border-slate-200 p-1.5 flex flex-col gap-1">
                            <div class="flex items-center justify-between gap-2 flex-wrap">
                                <div class="flex items-center gap-1.5">
                                    <span aria-hidden="true" class="material-icons-round text-slate-500 text-base">groups</span>
                                    <span class="text-sm font-bold text-slate-500 uppercase tracking-wider" data-i18n="label_grouping">Regroupement</span>
                                </div>
                                <span class="text-xs text-slate-600 font-medium bg-slate-100 border border-slate-200 rounded-full px-2 py-0.5" data-i18n="legend_grouping">Plein : Classe • Rayé : Groupes</span>
                            </div>
                            <div class="w-full h-4 flex rounded-lg overflow-hidden bg-slate-100 border border-slate-200 cursor-help timeline-zoom-outer" id="timeline-grouping">
                                <div class="timeline-inner" id="timeline-grouping-inner"></div>
                            </div>
                        </div>
                        <div class="timeline-track bg-white rounded-xl border border-slate-200 p-1.5 flex flex-col gap-1">
                            <div class="flex items-center justify-between gap-2 flex-wrap">
                                <div class="flex items-center gap-1.5">
                                    <span aria-hidden="true" class="material-icons-round text-slate-500 text-base">face</span>
                                    <span class="text-sm font-bold text-slate-500 uppercase tracking-wider" data-i18n="label_trainer">Formateur</span>
                                </div>
                                <span class="text-xs text-slate-600 font-medium bg-slate-100 border border-slate-200 rounded-full px-2 py-0.5" data-i18n="legend_trainer">Plein : Présent • Rayé : Absent</span>
                            </div>
                            <div class="w-full h-4 flex rounded-lg overflow-hidden bg-slate-100 border border-slate-200 cursor-help timeline-zoom-outer" id="timeline-trainer">
                                <div class="timeline-inner" id="timeline-trainer-inner"></div>
                            </div>
                        </div>
                        <div class="timeline-track bg-white rounded-xl border border-slate-200 p-1.5 flex flex-col gap-1">
                            <div class="flex items-center justify-between gap-2 flex-wrap">
                                <div class="flex items-center gap-1.5">
                                    <span aria-hidden="true" class="material-icons-round text-slate-500 text-base">place</span>
                                    <span class="text-sm font-bold text-slate-500 uppercase tracking-wider" data-i18n="label_place">Lieu</span>
                                </div>
                                <span class="text-xs text-slate-600 font-medium bg-slate-100 border border-slate-200 rounded-full px-2 py-0.5" data-i18n="legend_place">Plein : Présentiel • Rayé : En ligne</span>
                            </div>
                            <div class="w-full h-4 flex rounded-lg overflow-hidden bg-slate-100 border border-slate-200 cursor-help timeline-zoom-outer" id="timeline-place">
                                <div class="timeline-inner" id="timeline-place-inner"></div>
                            </div>
                        </div>
                        <div class="timeline-track bg-white rounded-xl border border-slate-200 p-1.5 flex flex-col gap-1">
                            <div class="flex items-center justify-between gap-2 flex-wrap">
                                <div class="flex items-center gap-1.5">
                                    <span aria-hidden="true" class="material-icons-round text-slate-500 text-base">event</span>
                                    <span class="text-sm font-bold text-slate-500 uppercase tracking-wider" data-i18n="label_time">Temps</span>
                                </div>
                                <span class="text-xs text-slate-600 font-medium bg-slate-100 border border-slate-200 rounded-full px-2 py-0.5" data-i18n="legend_time">Plein : Synchrone • Rayé : Asynchrone</span>
                            </div>
                            <div class="w-full h-4 flex rounded-lg overflow-hidden bg-slate-100 border border-slate-200 cursor-help timeline-zoom-outer" id="timeline-time">
                                <div class="timeline-inner" id="timeline-time-inner"></div>
                            </div>
                        </div>
                    </div>
                    <div class="w-full h-9 relative mt-1 select-none pointer-events-none rounded-lg bg-white timeline-zoom-outer" id="timeline-ruler">
                        <div class="timeline-inner" id="timeline-ruler-inner"></div>
                    </div>
                    <div aria-label="Défilement horizontal des visualisations" class="timeline-hscroll no-print" id="timeline-hscroll" role="scrollbar">
                        <div id="timeline-hscroll-inner"></div>
                        <div aria-hidden="true" id="timeline-hscroll-thumb"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden w-full flex flex-col justify-center">
            <button class="w-full px-3 py-2 flex items-center justify-between bg-slate-50 hover:bg-slate-100 transition-colors no-print h-[32px] rounded-lg border border-slate-200" onclick="togglePanel('charts-panel')" title="title_toggle_panel">
                <div class="flex items-center gap-1.5">
                    <span class="material-icons-round text-slate-500 text-sm">pie_chart</span>
                    <span class="font-bold text-slate-700 uppercase text-xs tracking-wide">Graphiques d'analyse</span>
                </div>
                <span class="material-icons-round text-slate-400 rotate-icon text-sm" id="charts-panel-icon">expand_more</span>
            </button>
            <div class="panel-content w-full flex flex-col gap-1 mt-1 p-1 rounded-lg border border-slate-200 bg-slate-50" id="charts-panel" style="display: none;">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                    <div class="bg-white rounded-xl border border-slate-200 p-2">
                        <div class="flex items-center justify-between">
                            <div class="text-xs font-bold text-slate-600">Types d'apprentissage</div>
                            <div class="text-[11px] text-slate-500">(% de durée)</div>
                        </div>
                        <div class="mt-2 flex gap-2 items-stretch">
                            <div class="w-1/2">
                                <canvas class="w-full" height="300" id="chart-learning-types"></canvas>
                            </div>
                            <div class="w-1/2 h-[300px] flex flex-col justify-center gap-1 text-[11px] leading-tight text-slate-700" id="chart-learning-types-legend"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 gap-2">
                        <div class="bg-white rounded-xl border border-slate-200 p-1.5">
                            <div class="flex items-center justify-between">
                                <div class="text-xs font-bold text-slate-600">Modes de groupes</div>
                                <div class="text-[11px] text-slate-500">(% de durée)</div>
                            </div>
                            <canvas height="80" id="chart-group-modes"></canvas>
                        </div>
                        <div class="bg-white rounded-xl border border-slate-200 p-1.5">
                            <div class="flex items-center justify-between">
                                <div class="text-xs font-bold text-slate-600">Modes de lieu</div>
                                <div class="text-[11px] text-slate-500">(% de durée)</div>
                            </div>
                            <canvas height="80" id="chart-place-modes"></canvas>
                        </div>
                        <div class="bg-white rounded-xl border border-slate-200 p-1.5">
                            <div class="flex items-center justify-between">
                                <div class="text-xs font-bold text-slate-600">Modes de temps</div>
                                <div class="text-[11px] text-slate-500">(% de durée)</div>
                            </div>
                            <canvas height="80" id="chart-time-modes"></canvas>
                        </div>
                        <div class="bg-white rounded-xl border border-slate-200 p-1.5">
                            <div class="flex items-center justify-between">
                                <div class="text-xs font-bold text-slate-600">Présence du formateur</div>
                                <div class="text-[11px] text-slate-500">(% de durée)</div>
                            </div>
                            <canvas height="80" id="chart-trainer-presence"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-designer">
            <div class="flex justify-end mb-2 no-print">
                <button class="text-slate-500 hover:text-indigo-600 text-xs font-medium flex items-center gap-1 transition-colors px-2 py-1 rounded hover:bg-slate-100" id="btn-toggle-all-main" onclick="toggleAllActivities()">
                    <span class="material-icons-round text-base" id="icon-toggle-all-main">unfold_less</span>
                    <span data-i18n="btn_collapse_all" id="text-toggle-all-main">Tout replier</span>
                </button>
            </div>
            <div class="space-y-4" id="activities-root"></div>
            <div class="hidden text-center py-12 bg-white rounded-xl border-2 border-dashed border-slate-300" id="empty-state">
                <h3 class="mt-1 text-base font-medium text-slate-900" data-i18n="empty_title">Aucun module conçu</h3>
                <p class="mt-0.5 text-xs text-slate-500" data-i18n="empty_subtitle">Commencez par créer votre premier module.</p>
                <button class="mt-4 inline-flex items-center px-3 py-1.5 border border-transparent shadow-sm text-xs font-medium rounded text-white bg-indigo-600 hover:bg-indigo-700" data-i18n-title="title_create_activity" onclick="addActivity()">
                    <span class="material-icons-round mr-1 text-sm">add</span>
                    <span data-i18n="btn_create_activity">Créer un Module</span>
                </button>
            </div>
        </div>

        <div class="mt-6 mb-4 no-print flex justify-start">
            <button class="bg-white border border-slate-300 hover:border-indigo-500 text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-3 py-1.5 rounded font-bold shadow-sm flex items-center gap-1.5 transition-all text-xs" data-i18n-title="title_new_activity" onclick="addActivity()">
                <span class="material-icons-round text-lg">add_circle</span>
                <span data-i18n="btn_new_activity">Nouveau Module</span>
            </button>
        </div>

        <footer class="mt-8 mb-4 text-center text-[11px] text-slate-400 no-print">
            <p>version 2.0 GW - François Jourde (2026) - CC BY SA</p>
            <details class="mt-1 inline-block text-left max-w-3xl mx-auto px-3">
                <summary class="cursor-pointer no-underline hover:text-slate-500 select-none bg-transparent hover:bg-transparent focus:bg-transparent active:bg-transparent" style="background: transparent;">Mentions légales / Confidentialité</summary>
                <div class="mt-2 text-slate-500 leading-relaxed">
                    <div class="font-semibold text-slate-400">Mentions Légales et Politique de Confidentialité</div>
                    <ol class="mt-2 space-y-2">
                        <li>
                            <div class="font-semibold text-slate-400">1. Fonctionnement et Données</div>
                            <div>Cette application fonctionne entièrement en mode « côté client ». Aucune donnée n'est envoyée à un serveur.</div>
                        </li>
                        <li>
                            <div class="font-semibold text-slate-400">2. Stockage Local</div>
                            <div>L'application utilise le localStorage de votre navigateur pour sauvegarder votre travail en cours.</div>
                        </li>
                    </ol>
                </div>
            </details>
        </footer>
    </div>

    <div class="hidden fixed inset-0 bg-slate-900 bg-opacity-50 z-50 flex items-center justify-center p-4" id="custom-confirm-modal">
        <div class="bg-white rounded-lg shadow-lg p-4 max-w-sm w-full">
            <h3 class="text-sm font-bold text-slate-800 mb-2" data-i18n="modal_confirm_title">Confirmer l'action</h3>
            <p class="text-slate-600 mb-4 text-xs" id="custom-confirm-msg">Êtes-vous sûr ?</p>
            <div class="flex justify-end gap-2">
                <button class="px-3 py-1.5 text-slate-600 hover:bg-slate-100 rounded text-xs font-medium transition-colors" data-i18n="btn_cancel" id="custom-confirm-no">Annuler</button>
                <button class="px-3 py-1.5 bg-red-500 text-white hover:bg-red-600 rounded text-xs font-medium transition-colors" data-i18n="btn_delete" id="custom-confirm-yes">Supprimer</button>
            </div>
        </div>
    </div>
    <div class="fixed z-[100] hidden bg-slate-800 text-white text-[10px] font-medium rounded px-2 py-1.5 pointer-events-none shadow-xl border border-slate-700 max-w-[200px] whitespace-normal leading-tight" id="global-tooltip"></div>

    <template id="activity-template">
        <div class="activity-group relative bg-white rounded-xl shadow-sm border border-slate-200 p-3">
            <div class="flex flex-col sm:flex-row sm:items-start justify-between mb-2 gap-2">
                <div class="flex-1 flex items-center gap-2">
                    <div class="drag-handle-activity drag-handle text-slate-300 hover:text-slate-500 no-print flex items-center justify-center w-6 h-6 cursor-grab">
                        <span class="material-icons-round text-lg">drag_indicator</span>
                    </div>
                    <div class="h-6 w-6 rounded-full bg-slate-200 flex items-center justify-center font-bold text-slate-600 activity-index shrink-0 text-xs">1</div>
                    <div class="flex-1 w-full">
                        <input class="activity-title text-base font-bold text-slate-800 bg-transparent border-b border-transparent hover:border-slate-300 focus:border-indigo-500 outline-none w-full py-0.5 transition-colors" data-i18n-placeholder="ph_activity_title" oninput="App.Timeline.updateStatsDebounced()" placeholder="Titre du module (ex: Module 1 : Introduction)" type="text"/>
                        <div class="flex items-center gap-2 mt-0.5 pr-1">
                            <div class="activity-type-bar flex-1 h-1.5 bg-slate-100 border border-slate-200 rounded-full overflow-hidden flex"></div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-1 no-print">
                    <div class="flex items-center gap-3 mr-2">
                        <div class="flex flex-col items-end">
                            <span class="text-[9px] text-slate-400 uppercase font-bold tracking-wider leading-none mb-0.5" data-i18n="label_target">Cible</span>
                            <div class="flex items-center gap-1">
                                <input class="activity-target-time w-12 px-1 py-0.5 text-xs text-right border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none h-[22px]" min="0" oninput="App.Timeline.updateStatsDebounced()" placeholder="0" type="number"/>
                                <select class="activity-target-unit w-20 px-0 py-0.5 text-[10px] border border-slate-200 rounded bg-slate-50 focus:ring-1 focus:ring-indigo-500 outline-none h-[22px]" onchange="App.Timeline.updateStats()">
                                    <option data-i18n="unit_mins" value="60">min</option>
                                    <option data-i18n="unit_hours" value="3600">Heures</option>
                                    <option data-i18n="unit_days" value="86400">Jours</option>
                                    <option data-i18n="unit_weeks" value="604800">Semaines</option>
                                    <option data-i18n="unit_months" value="2592000">Mois</option>
                                </select>
                            </div>
                        </div>
                        <span aria-hidden="true" class="module-time-compare text-xs font-bold bg-transparent mx-1 select-none self-center">=</span>
                        <div class="flex flex-col items-end">
                            <span class="text-[9px] text-slate-400 uppercase font-bold tracking-wider leading-none mb-0.5" data-i18n="label_designed">Conçu</span>
                            <div class="bg-indigo-50 border border-indigo-100 rounded px-2 py-0.5 h-[22px] flex items-center min-w-[3rem] justify-end activity-designed-badge">
                                <span class="activity-total-time text-xs font-bold text-indigo-700 font-mono">0m</span>
                            </div>
                        </div>
                    </div>
                    <div class="h-8 w-px bg-slate-100 mx-1"></div>
                    <button class="text-slate-400 hover:text-indigo-500 p-1 transition-colors" data-i18n-title="title_toggle_description" data-action="toggle-module-description" title="Afficher/Masquer la description"><span class="material-icons-round text-lg">description</span></button>
                    <button class="text-slate-400 hover:text-indigo-500 p-1 transition-colors" data-i18n-title="title_toggle_panel" data-action="toggle-module" title="Afficher/Masquer les paramètres"><span class="material-icons-round text-lg rotate-icon">expand_more</span></button>
                    <button class="text-slate-400 hover:text-indigo-500 p-1 transition-colors" data-action="duplicate-module" data-i18n-title="title_duplicate_activity" title="Dupliquer ce module" type="button"><span class="material-icons-round text-lg">content_copy</span></button>
                    <button aria-pressed="false" class="text-slate-400 hover:text-indigo-500 p-1 transition-colors" data-i18n-title="title_focus_module" data-action="focus-module" title="Mode focus" type="button"><span class="material-icons-round text-lg focus-toggle-icon">center_focus_strong</span></button>
                    <button class="text-slate-400 hover:text-red-500 p-1 transition-colors" data-action="delete-module" data-i18n-title="title_delete_activity" title="Supprimer ce module" type="button"><span class="material-icons-round text-lg">delete_outline</span></button>
                </div>
            </div>
            <div class="activity-body panel-content open">
                <div class="activity-description-panel panel-content">
                    <div class="mb-2 ml-8 pr-1">
                        <textarea class="activity-description w-full px-3 py-2 text-sm text-slate-700 border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none resize-y bg-slate-50 leading-relaxed" data-i18n-placeholder="ph_activity_desc" placeholder="Description du module..." rows="1"></textarea>
                    </div>
                </div>
                <div class="activity-moments-container ml-4 pl-4 space-y-3 min-h-[20px]"></div>
                <div class="mt-2 pt-1 flex justify-center gap-2 no-print border-t border-slate-100">
                    <button class="text-sm font-semibold text-slate-500 hover:text-indigo-700 px-3 py-1 rounded transition-colors flex items-center gap-1 hover:bg-slate-50" data-i18n-title="title_add_step" data-action="add-step" type="button">
                        <span class="material-icons-round text-sm">add</span>
                        <span data-i18n="btn_add_step">Ajouter Activité</span>
                    </button>
                    <button class="text-sm font-semibold text-slate-500 hover:text-indigo-700 px-3 py-1 rounded transition-colors flex items-center gap-1 hover:bg-slate-50" data-action="add-moment" title="Ajouter un moment" type="button">
                        <span class="material-icons-round text-sm">add</span>
                        <span>Ajouter un moment</span>
                    </button>
                </div>
            </div>
        </div>
    </template>

    <template id="moment-template">
        <div class="moment-group bg-transparent rounded-lg border border-slate-200/60">
            <div class="flex items-center justify-between px-3 py-2">
                <div class="flex items-center gap-2 flex-1 min-w-0">
                    <div class="drag-handle-moment drag-handle text-slate-300 hover:text-slate-500 no-print flex items-center justify-center w-6 h-6 cursor-grab">
                        <span class="material-icons-round text-lg">drag_indicator</span>
                    </div>
                    <div class="h-6 w-6 rounded-full bg-slate-200 flex items-center justify-center font-bold text-slate-600 moment-index shrink-0 text-xs">1</div>
                    <input class="moment-title flex-1 text-sm font-semibold text-slate-800 bg-transparent focus:outline-none focus:ring-0 border-0 p-0 m-0 min-w-0" placeholder="Nom du moment (ex : Accueil)" type="text"/>
                </div>
                <div class="flex items-center gap-3">
                    <div class="flex items-center gap-2">
                        <div class="moment-target-wrap flex flex-col items-end">
                            <span class="text-[9px] text-slate-400 uppercase font-bold tracking-wider leading-none mb-0.5" data-i18n="label_target">Cible</span>
                            <div class="flex gap-1 items-center">
                                <input class="moment-target-time w-12 px-1 py-0.5 text-xs border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none h-[22px]" min="0" oninput="App.Timeline.updateStatsDebounced()" placeholder="0" type="number"/>
                                <select class="moment-target-unit w-20 px-1 py-0.5 text-xs border border-slate-200 rounded bg-slate-50 focus:ring-1 focus:ring-indigo-500 outline-none h-[22px]" onchange="App.Timeline.updateStats()">
                                    <option data-i18n="unit_mins" value="60">min</option>
                                    <option data-i18n="unit_hours" value="3600">Heures</option>
                                    <option data-i18n="unit_days" value="86400">Jours</option>
                                    <option data-i18n="unit_weeks" value="604800">Semaines</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex flex-col items-end">
                            <span class="text-[9px] text-slate-400 uppercase font-bold tracking-wider leading-none mb-0.5" data-i18n="label_designed">Conçu</span>
                            <div class="bg-indigo-50 border border-indigo-100 rounded px-2 py-0.5 h-[22px] flex items-center min-w-[3rem] justify-end">
                                <span class="moment-total-time text-xs font-bold text-indigo-700 font-mono">0m</span>
                            </div>
                        </div>
                    </div>
                    <button aria-expanded="false" class="no-print text-slate-400 hover:text-indigo-500 p-1 transition-colors" data-i18n-title="title_toggle_description" data-action="toggle-moment-description" title="Afficher/Masquer la description" type="button"><span class="material-icons-round text-lg">description</span></button>
                    <button aria-expanded="true" class="no-print text-slate-400 hover:text-slate-700 transition-colors" data-action="toggle-moment" title="Replier / déplier ce moment" type="button">
                        <span class="material-icons-round text-lg rotate-icon-moment" style="transform: rotate(180deg);">expand_more</span>
                    </button>
                    <button class="no-print text-slate-400 hover:text-rose-600 transition-colors" data-action="delete-moment" title="Supprimer ce moment" type="button">
                        <span class="material-icons-round text-lg">delete_outline</span>
                    </button>
                </div>
            </div>
            <div class="moment-body px-3 pb-3">
                <div class="moment-description-wrap hidden mt-2">
                    <div class="compact-label">Description</div>
                    <textarea class="moment-description w-full min-h-[64px] resize-y px-3 py-2 text-sm border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Description du moment..."></textarea>
                </div>
                <div class="activity-steps-container activity-container space-y-2 min-h-[20px]"></div>
            </div>
        </div>
    </template>

    <template id="step-template">
        <div class="step-card bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden relative group flex flex-col">
            <div class="flex items-center gap-2 p-2 bg-slate-50 border-b border-slate-100 transition-colors">
                <div class="drag-handle-step drag-handle flex items-center justify-center text-slate-300 hover:text-slate-500 cursor-grab">
                    <span class="material-icons-round text-base">drag_indicator</span>
                </div>
                <div class="flex-1">
                    <input class="step-input-title w-full px-1 py-0.5 text-sm font-semibold text-slate-800 border-none bg-transparent focus:ring-0 outline-none" data-i18n-placeholder="ph_step_title" placeholder="Titre de l'activité..." type="text"/>
                </div>
                <div class="w-28 mr-1">
                    <select class="gws-tool-select w-full px-1 py-0.5 text-[10px] font-medium border border-slate-200 rounded bg-white outline-none h-[22px]">
                        <option value="" disabled selected>Outil...</option>
                        <option value="drive">Drive</option>
                        <option value="gmail">Gmail</option>
                        <option value="docs">Docs</option>
                        <option value="sheets">Sheets</option>
                        <option value="slides">Slides</option>
                        <option value="forms">Forms</option>
                        <option value="calendar">Calendar</option>
                        <option value="meet">Meet / Chat</option>
                        <option value="sites">Sites</option>
                        <option value="keep">Keep / Tasks</option>
                        <option value="admin">Console Admin</option>
                    </select>
                </div>
                <div class="flex items-center gap-1">
                    <input class="duration-input w-16 px-2 py-0.5 text-xs font-semibold border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none h-[22px] text-right text-slate-600" min="0" oninput="App.Timeline.updateStatsDebounced()" placeholder="0" type="number"/>
                    <select class="duration-unit w-24 px-2 py-0.5 text-xs border border-slate-200 rounded bg-slate-50 focus:ring-1 focus:ring-indigo-500 outline-none h-[22px]" onchange="App.Timeline.updateStats()">
                        <option data-i18n="unit_mins" value="60">min</option>
                        <option data-i18n="unit_hours" value="3600">Heures</option>
                        <option data-i18n="unit_days" value="86400">Jours</option>
                        <option data-i18n="unit_weeks" value="604800">Semaines</option>
                    </select>
                </div>
                <div class="w-24 learning-type-container">
                    <select class="learning-type-select w-full px-2 py-0.5 text-xs font-bold border rounded focus:ring-1 focus:ring-indigo-500 outline-none transition-all select-demonstration h-[22px]" onchange="updateStepType(this)">
                        <option data-i18n="type_none" value="none">Neutre</option>
                        <option value="demonstration">Démonstration</option>
                        <option value="lab">Labo Pratique</option>
                        <option value="collaboration">Co-édition</option>
                        <option value="scenario">Cas Métier</option>
                        <option value="evaluation">Quiz / Certif.</option>
                        <option value="migration">Transition</option>
                    </select>
                </div>
                <div class="flex items-center gap-0.5 no-print">
                    <button class="text-slate-400 hover:text-indigo-500 p-0.5" data-i18n-title="title_toggle_panel" data-action="toggle-step" title="Afficher/Masquer les paramètres"><span class="material-icons-round text-base rotate-icon">expand_more</span></button>
                    <button class="text-slate-300 hover:text-indigo-500 p-0.5" data-action="duplicate-step" data-i18n-title="title_duplicate_step" title="Dupliquer cette activité" type="button"><span class="material-icons-round text-base">content_copy</span></button>
                    <button class="text-slate-300 hover:text-red-400 p-0.5" data-action="delete-step" data-i18n-title="title_delete_step" title="Supprimer cette activité" type="button"><span class="material-icons-round text-base">delete_outline</span></button>
                </div>
            </div>
            <div class="step-body panel-content collapsed p-3 pt-2">
                <div class="flex flex-col lg:flex-row gap-3 mt-1">
                    <div class="lg:w-1/3 space-y-2">
                        <div>
                            <label class="compact-label compact-label-lg flex items-center gap-1">
                                <span class="material-icons-round text-[10px] text-slate-400">groups</span>
                                <span data-i18n="label_grouping">Regroupement</span>
                            </label>
                            <div class="space-y-1">
                                <select class="step-group-mode w-full px-2 py-0.5 text-xs rounded border border-slate-200 bg-white outline-none h-[24px]" onchange="toggleGroupMode(this)">
                                    <option data-i18n="opt_whole_class" value="class">Groupe entier</option>
                                    <option data-i18n="opt_groups" value="groups">Sous-groupe</option>
                                    <option data-i18n="opt_individual" value="individual">Individuel</option>
                                </select>
                                <div class="step-group-details hidden flex gap-1">
                                    <div class="relative flex-1">
                                        <input class="step-group-count w-full px-2 py-0.5 text-xs border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none h-[24px]" data-i18n-placeholder="ph_nb_groups" min="1" oninput="updateGroupMath(this, 'count')" placeholder="Nb groupes" type="number"/>
                                        <span class="absolute right-1 top-1/2 -translate-y-1/2 text-[8px] text-slate-400 pointer-events-none pr-1" data-i18n="label_short_groups">Grps</span>
                                    </div>
                                    <div class="relative flex-1">
                                        <input class="step-group-size w-full px-2 py-0.5 text-xs border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none h-[24px]" data-i18n-placeholder="ph_per_group" min="1" oninput="updateGroupMath(this, 'size')" placeholder="Par groupe" type="number"/>
                                        <span class="absolute right-1 top-1/2 -translate-y-1/2 text-[8px] text-slate-400 pointer-events-none pr-1" data-i18n="label_short_pers">Pers</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-1 pt-1 border-t border-slate-100">
                            <div class="space-y-0.5">
                                <span class="text-[10px] w-12 text-slate-400 font-bold uppercase flex items-center gap-0.5 relative z-10">
                                    <span class="material-icons-round text-[10px]">face</span>
                                    <span data-i18n="label_trainer">Formateur</span>
                                </span>
                                <select class="trainer-select w-full px-1 py-0.5 text-[10px] rounded border border-slate-200 bg-white outline-none h-[22px]" onchange="App.Timeline.updateStats()">
                                    <option data-i18n="opt_present" value="present">Présent</option>
                                    <option data-i18n="opt_absent" value="absent">Absent</option>
                                </select>
                            </div>
                            <div class="space-y-0.5">
                                <span class="text-[10px] w-12 text-slate-400 font-bold uppercase flex items-center gap-0.5 relative z-10">
                                    <span class="material-icons-round text-[10px]">place</span>
                                    <span data-i18n="label_place">Lieu</span>
                                </span>
                                <select class="place-select w-full px-1 py-0.5 text-[10px] rounded border border-slate-200 bg-white outline-none h-[22px]" onchange="App.Timeline.updateStats()">
                                    <option data-i18n="opt_insitu" value="situ">Présentiel (sur site)</option>
                                    <option data-i18n="opt_online" value="online">Distanciel (en ligne)</option>
                                    <option data-i18n="opt_hybrid" value="hybrid">Hybride</option>
                                </select>
                            </div>
                            <div class="space-y-0.5">
                                <span class="text-[10px] w-12 text-slate-400 font-bold uppercase flex items-center gap-0.5 relative z-10">
                                    <span class="material-icons-round text-[10px]">event</span>
                                    <span data-i18n="label_time">Temps</span>
                                </span>
                                <select class="time-select w-full px-1 py-0.5 text-[10px] rounded border border-slate-200 bg-white outline-none h-[22px]" onchange="App.Timeline.updateStats()">
                                    <option data-i18n="opt_sync" value="sync">Synchrone</option>
                                    <option data-i18n="opt_async" value="async">Asynchrone</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="lg:w-2/3 space-y-2">
                        <div>
                            <label class="compact-label flex items-center gap-1">
                                <span class="material-icons-round text-[10px] text-slate-400">flag</span>
                                <span>Objectif de l'activité</span>
                            </label>
                            <textarea class="step-input-objective w-full px-2 py-1.5 text-[12px] border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-200 focus:border-indigo-300 bg-slate-50 text-slate-700" placeholder="Décrivez l'objectif de cette activité..." rows="2"></textarea>
                        </div>
                        <div>
                            <label class="compact-label flex items-center gap-1">
                                <span class="material-icons-round text-[10px] text-slate-400">assignment</span>
                                <span data-i18n="label_tasks">Ce que les apprenants doivent faire</span>
                            </label>
                            <textarea class="step-input-tasks w-full px-2 py-1.5 text-xs border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none resize-y leading-relaxed" data-i18n-placeholder="ph_tasks" placeholder="Décrivez les étapes, instructions et tâches..." rows="2"></textarea>
                        </div>
                        <div>
                            <label class="compact-label flex items-center gap-1">
                                <span class="material-icons-round text-[10px] text-slate-400">comment</span>
                                <span data-i18n="label_notes">Notes</span>
                            </label>
                            <textarea class="step-input-notes w-full px-2 py-1.5 text-xs border border-slate-200 rounded focus:ring-1 focus:ring-indigo-500 outline-none resize-y bg-slate-50 text-slate-600 italic" data-i18n-placeholder="ph_notes" placeholder="Notes formateur, ressources ou liens..." rows="2"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <div id="js-error-banner" style="display:none; position:fixed; bottom:12px; left:12px; right:12px; z-index:9999; background:#fee2e2; color:#7f1d1d; padding:8px 10px; border:1px solid #fecaca; border-radius:10px; font-size:12px; line-height:1.2; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; box-shadow:0 10px 30px rgba(15,23,42,0.15);">
        <div style="display:flex; gap:10px; align-items:flex-start;">
            <div style="flex:1;">
                <div style="font-weight:700; margin-bottom:3px;">Erreur</div>
                <div data-js-error-text="">Une erreur est survenue.</div>
            </div>
            <button aria-label="Fermer" onclick="document.getElementById('js-error-banner').style.display='none'" style="background:transparent; border:0; color:#7f1d1d; font-weight:700; cursor:pointer; padding:0 6px; line-height:1;" type="button">×</button>
        </div>
    </div>

    <div class="hidden fixed inset-0 z-[9999] bg-black/50 flex items-center justify-center p-4 no-print" data-display="flex" id="template-export-modal">
        <div class="bg-white w-full max-w-xl rounded-xl shadow-xl border border-slate-200 overflow-hidden">
            <div class="flex items-center justify-between px-4 py-3 border-b border-slate-200">
                <div>
                    <div class="text-sm font-semibold text-slate-800">Exporter un modèle</div>
                    <div class="text-xs text-slate-500">Choisissez précisément l’élément à exporter.</div>
                </div>
                <button class="text-slate-500 hover:text-slate-800 px-2 py-1 rounded" id="template-export-close" type="button">✕</button>
            </div>
            <div class="p-4 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div>
                        <label class="text-xs font-medium text-slate-700">Niveau</label>
                        <select class="mt-1 w-full border border-slate-300 rounded-md px-2 py-1.5 text-sm" id="template-export-type">
                            <option value="module">Module</option>
                            <option value="moment">Moment</option>
                            <option value="activity">Activité</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-medium text-slate-700">Élément</label>
                        <select class="mt-1 w-full border border-slate-300 rounded-md px-2 py-1.5 text-sm" id="template-export-item"></select>
                    </div>
                </div>
                <div class="flex items-center justify-end gap-2 pt-2">
                    <button class="px-3 py-1.5 rounded-md border border-slate-300 text-sm text-slate-700 hover:bg-slate-50" id="template-export-cancel" type="button">Annuler</button>
                    <button class="px-3 py-1.5 rounded-md bg-indigo-600 text-white text-sm hover:bg-indigo-700" id="template-export-do" type="button">Exporter</button>
                </div>
                <div class="hidden text-sm text-red-600" id="template-export-error"></div>
            </div>
        </div>
    </div>

    <div class="hidden fixed inset-0 z-[9999] bg-black/50 flex items-center justify-center p-4 no-print" data-display="flex" id="template-import-modal">
        <div class="bg-white w-full max-w-2xl rounded-xl shadow-xl border border-slate-200 overflow-hidden">
            <div class="flex items-center justify-between px-4 py-3 border-b border-slate-200">
                <div>
                    <div class="text-sm font-semibold text-slate-800">Importer un modèle</div>
                    <div class="text-xs text-slate-500">Choisissez précisément où insérer le modèle.</div>
                </div>
                <button class="text-slate-500 hover:text-slate-800 px-2 py-1 rounded" id="template-import-close" type="button">✕</button>
            </div>
            <div class="p-4 space-y-4">
                <div class="flex items-center gap-2">
                    <button class="px-3 py-1.5 rounded-md bg-indigo-600 text-white text-sm hover:bg-indigo-700" id="template-import-pick" type="button">Choisir un fichier…</button>
                    <div class="text-sm text-slate-600 truncate" id="template-import-filelabel"></div>
                </div>
                <div class="hidden space-y-3" id="template-import-placements">
                    <div class="text-xs text-slate-500">Type détecté : <span class="font-semibold text-slate-700" id="template-import-type"></span></div>
                    <div class="hidden border border-slate-200 rounded-lg p-3" id="tpl-place-module">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs font-medium text-slate-700">Position</label>
                                <select class="mt-1 w-full border border-slate-300 rounded-md px-2 py-1.5 text-sm" id="tpl-module-position">
                                    <option value="start">Au début</option>
                                    <option value="end">À la fin</option>
                                    <option value="after">Après…</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-medium text-slate-700">Module de référence</label>
                                <select class="mt-1 w-full border border-slate-300 rounded-md px-2 py-1.5 text-sm" id="tpl-module-after"></select>
                            </div>
                        </div>
                    </div>
                    <div class="hidden border border-slate-200 rounded-lg p-3" id="tpl-place-moment">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <div>
                                <label class="text-xs font-medium text-slate-700">Module cible</label>
                                <select class="mt-1 w-full border border-slate-300 rounded-md px-2 py-1.5 text-sm" id="tpl-moment-module"></select>
                            </div>
                            <div>
                                <label class="text-xs font-medium text-slate-700">Position</label>
                                <select class="mt-1 w-full border border-slate-300 rounded-md px-2 py-1.5 text-sm" id="tpl-moment-position">
                                    <option value="start">Au début</option>
                                    <option value="end">À la fin</option>
                                    <option value="after">Après…</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-medium text-slate-700">Moment de référence</label>
                                <select class="mt-1 w-full border border-slate-300 rounded-md px-2 py-1.5 text-sm" id="tpl-moment-after"></select>
                            </div>
                        </div>
                    </div>
                    <div class="hidden border border-slate-200 rounded-lg p-3" id="tpl-place-activity">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <div>
                                <label class="text-xs font-medium text-slate-700">Module cible</label>
                                <select class="mt-1 w-full border border-slate-300 rounded-md px-2 py-1.5 text-sm" id="tpl-act-module"></select>
                            </div>
                            <div>
                                <label class="text-xs font-medium text-slate-700">Moment cible</label>
                                <select class="mt-1 w-full border border-slate-300 rounded-md px-2 py-1.5 text-sm" id="tpl-act-moment"></select>
                            </div>
                            <div>
                                <label class="text-xs font-medium text-slate-700">Position</label>
                                <select class="mt-1 w-full border border-slate-300 rounded-md px-2 py-1.5 text-sm" id="tpl-act-position">
                                    <option value="start">Au début</option>
                                    <option value="end">À la fin</option>
                                    <option value="after">Après…</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-medium text-slate-700">Activité de référence</label>
                                <select class="mt-1 w-full border border-slate-300 rounded-md px-2 py-1.5 text-sm" id="tpl-act-after"></select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-end gap-2 pt-2">
                    <button class="px-3 py-1.5 rounded-md border border-slate-300 text-sm text-slate-700 hover:bg-slate-50" id="template-import-cancel" type="button">Annuler</button>
                    <button class="px-3 py-1.5 rounded-md bg-indigo-600 text-white text-sm hover:bg-indigo-700" id="template-import-do" type="button">Importer</button>
                </div>
                <div class="hidden text-sm text-red-600" id="template-import-error"></div>
            </div>
        </div>
    </div>
</body>
</html>
